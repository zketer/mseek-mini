<!--checkin.wxml-->
<view class="page-container">
  <!-- æ‰“å¡å¡ç‰‡ -->
  <view class="checkin-card" wx:if="{{nearestMuseum}}">
    <view class="card-header">
      <view class="location-info">
        <text class="location-icon">ğŸ“</text>
        <text class="current-location">{{currentLocation}}</text>
        <view class="refresh-btn" bindtap="onRefreshLocation">
          <image src="/images/refresh.svg" class="refresh-icon" mode="aspectFit" />
        </view>
      </view>
    </view>
    
    <view class="card-content">
      <image src="{{nearestMuseum.image}}" mode="aspectFill" class="museum-image" />
      <view class="museum-info">
        <text class="museum-name">{{nearestMuseum.name}}</text>
        <view class="museum-distance">
          <icon type="locationfill" size="12" color="#999"></icon>
          <text class="distance-text">è·ç¦»{{nearestMuseum.distance}}</text>
        </view>
        <view class="museum-status">
          <view class="status-dot {{nearestMuseum.canCheckin ? 'status-available' : 'status-unavailable'}}"></view>
          <text class="status-text">{{nearestMuseum.canCheckin ? 'åœ¨æ‰“å¡èŒƒå›´å†…' : 'è·ç¦»è¿‡è¿œï¼Œæ— æ³•æ‰“å¡'}}</text>
        </view>
      </view>
    </view>
    
    <view class="card-actions">
      <view class="checkin-main-btn {{nearestMuseum.canCheckin ? 'btn-enabled' : 'btn-disabled'}}" 
            bindtap="onMainCheckinTap" 
            data-id="{{nearestMuseum.id}}">
        {{nearestMuseum.canCheckin ? 'ç«‹å³æ‰“å¡' : 'å‰å¾€åšç‰©é¦†'}}
      </view>
    </view>
  </view>

  <!-- æš‚å­˜å¡ç‰‡ -->
  <view class="draft-card" wx:if="{{isLoggedIn && draftCount > 0}}" bindtap="onViewDraftList">
    <view class="draft-icon">ğŸ“</view>
    <view class="draft-info">
      <text class="draft-title">æš‚å­˜è‰ç¨¿</text>
      <text class="draft-desc">{{draftCount}}ä¸ªæœªå®Œæˆçš„æ‰“å¡</text>
    </view>
    <view class="draft-arrow">></view>
  </view>

  <!-- æ‰“å¡è®°å½• -->
  <view class="history-section">
    <view class="section-header-simple">
      <text class="section-title">æœ€è¿‘æ‰“å¡</text>
      <text class="section-more" bindtap="onViewHistory">æŸ¥çœ‹å…¨éƒ¨</text>
    </view>

    <view class="history-list" wx:if="{{checkinHistory.length > 0}}">
      <view class="history-item" wx:for="{{checkinHistory}}" wx:key="id" bindtap="onHistoryTap" data-id="{{item.id}}">
        <image src="{{item.image}}" mode="aspectFill" class="history-image" />
        <view class="history-info">
          <view class="history-name">{{item.museumName}}</view>
          <view class="history-time">{{item.checkinTime}}</view>
          <view class="history-points">+{{item.points}}ç§¯åˆ†</view>
        </view>
      </view>
    </view>

    <view class="empty-history" wx:else>
      <image src="/images/Icon1.png" class="empty-icon" mode="aspectFit" />
      <text class="empty-text">è¿˜æ²¡æœ‰æ‰“å¡è®°å½•</text>
      <text class="empty-desc">å»å‘ç°é¡µé¢æ‰¾æ‰¾å¿ƒä»ªçš„åšç‰©é¦†å§</text>
    </view>
  </view>

  <!-- é™„è¿‘åšç‰©é¦† -->
  <view class="nearby-section">
    <view class="section-header">
      <view class="header-main">
        <text class="section-title">é™„è¿‘åšç‰©é¦†</text>
        
        <!-- è·ç¦»é€‰æ‹©å™¨ -->
        <view class="distance-selector">
          <text class="distance-label">èŒƒå›´</text>
          <view class="distance-tabs">
            <view 
              class="distance-tab {{selectedDistance === 10 ? 'tab-active' : ''}}" 
              bindtap="onDistanceSelect" 
              data-distance="10"
            >
              10
            </view>
            <view 
              class="distance-tab {{selectedDistance === 30 ? 'tab-active' : ''}}" 
              bindtap="onDistanceSelect" 
              data-distance="30"
            >
              30
            </view>
            <view 
              class="distance-tab {{selectedDistance === 50 ? 'tab-active' : ''}}" 
              bindtap="onDistanceSelect" 
              data-distance="50"
            >
              50
            </view>
          </view>
          <text class="distance-unit">km</text>
        </view>
      </view>
    </view>

    <view class="nearby-list">
      <view class="nearby-item" wx:for="{{nearbyMuseums}}" wx:key="id" bindtap="onNearbyMuseumTap" data-id="{{item.id}}">
        <image src="{{item.image}}" mode="aspectFill" class="nearby-image" />
        <view class="nearby-info">
          <view class="nearby-name">{{item.name}}</view>
          <view class="nearby-distance">
            <icon type="locationfill" size="12" color="#999"></icon>
            <text class="distance-text">è·ç¦»{{item.distance}}</text>
          </view>
          <view class="nearby-status">
            <view class="status-dot {{item.canCheckin ? 'status-available' : 'status-unavailable'}}"></view>
            <text class="status-text">{{item.canCheckin ? 'å¯æ‰“å¡' : 'è·ç¦»è¿‡è¿œ'}}</text>
          </view>
        </view>

      </view>
    </view>
  </view>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-spacing"></view>
</view>
