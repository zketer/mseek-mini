<!--detail.wxml-->
<view class="page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <image src="/images/loading.gif" class="loading-icon" mode="aspectFit" />
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- çœä»½æ¦‚è§ˆ -->
  <view class="province-header" wx:if="{{provinceInfo}}">
    <view class="header-content">
      <view class="province-title">
        <text class="province-name">{{provinceInfo.provinceName}}</text>
        <text class="province-subtitle">åšç‰©é¦†åˆ†å¸ƒ</text>
      </view>
      
      <!-- åŸå¸‚æ¨¡å¼ç»Ÿè®¡ -->
      <view class="province-stats" wx:if="{{viewMode === 'cities'}}">
        <view class="stat-card">
          <text class="stat-number">{{provinceInfo.unlockedCities}}/{{provinceInfo.totalCities}}</text>
          <text class="stat-label">åŸå¸‚</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{provinceInfo.visitedMuseums}}/{{provinceInfo.totalMuseums}}</text>
          <text class="stat-label">å·²æ‰“å¡</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{provinceInfo.completionRate}}%</text>
          <text class="stat-label">å®Œæˆåº¦</text>
        </view>
      </view>

      <!-- åšç‰©é¦†æ¨¡å¼ç»Ÿè®¡ -->
      <view class="province-stats" wx:if="{{viewMode === 'museums'}}">
        <view class="stat-card">
          <text class="stat-number">{{provinceInfo.visitedMuseums}}/{{provinceInfo.totalMuseums}}</text>
          <text class="stat-label">å·²æ‰“å¡</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{provinceInfo.totalMuseums - provinceInfo.visitedMuseums}}</text>
          <text class="stat-label">å¾…æ¢ç´¢</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{provinceInfo.completionRate}}%</text>
          <text class="stat-label">å®Œæˆåº¦</text>
        </view>
      </view>
      
      <view class="province-progress">
        <view class="progress-bar">
          <view 
            class="progress-fill" 
            style="width: {{provinceInfo.completionRate}}%"
          ></view>
        </view>
      </view>
      
      <!-- è§†å›¾æ¨¡å¼åˆ‡æ¢ -->
      <view class="view-mode-tabs">
        <view 
          class="mode-tab {{viewMode === 'cities' ? 'active' : ''}}"
          bindtap="onViewModeChange"
          data-mode="cities"
        >
          <text class="mode-text">åŸå¸‚åˆ†å¸ƒ</text>
        </view>
        <view 
          class="mode-tab {{viewMode === 'museums' ? 'active' : ''}}"
          bindtap="onViewModeChange"
          data-mode="museums"
        >
          <text class="mode-text">åšç‰©é¦†åˆ—è¡¨</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åºï¼ˆä»…åšç‰©é¦†æ¨¡å¼ï¼‰ -->
  <view class="filter-section" wx:if="{{provinceInfo && viewMode === 'museums'}}">
    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="filter-tabs">
      <view 
        class="filter-tab {{filterStatus === 'all' ? 'active' : ''}}"
        bindtap="onFilterTap"
        data-status="all"
      >
        <text class="tab-text">å…¨éƒ¨</text>
      </view>
      <view 
        class="filter-tab {{filterStatus === 'visited' ? 'active' : ''}}"
        bindtap="onFilterTap"
        data-status="visited"
      >
        <text class="tab-text">å·²æ‰“å¡</text>
      </view>
      <view 
        class="filter-tab {{filterStatus === 'unvisited' ? 'active' : ''}}"
        bindtap="onFilterTap"
        data-status="unvisited"
      >
        <text class="tab-text">å¾…æ¢ç´¢</text>
      </view>
    </view>
  </view>

  <!-- åŸå¸‚åˆ—è¡¨ -->
  <view class="cities-section" wx:if="{{provinceInfo && viewMode === 'cities'}}">
    <view class="cities-grid">
      <view 
        class="city-card {{item.visitedMuseums > 0 ? 'unlocked' : 'locked'}}"
        wx:for="{{provinceInfo.cities}}" 
        wx:key="cityName"
        bindtap="onCityTap"
        data-name="{{item.cityName}}"
      >
        <!-- åŸå¸‚å›¾æ ‡ -->
        <view class="city-icon">
          <text class="city-emoji">{{item.visitedMuseums > 0 ? 'ğŸ™ï¸' : 'ğŸ”’'}}</text>
        </view>
        
        <!-- åŸå¸‚ä¿¡æ¯ -->
        <view class="city-info">
          <text class="city-name">{{item.cityName}}</text>
          <text class="city-stats" wx:if="{{item.visitedMuseums > 0}}">
            {{item.visitedMuseums}}/{{item.totalMuseums}} åšç‰©é¦†
          </text>
          <text class="city-locked" wx:if="{{item.visitedMuseums === 0}}">
            {{item.totalMuseums}} ä¸ªåšç‰©é¦†å¾…æ¢ç´¢
          </text>
        </view>
        
        <!-- å®Œæˆåº¦æŒ‡ç¤ºå™¨ -->
        <view class="completion-indicator" wx:if="{{item.visitedMuseums > 0}}">
          <view class="completion-bar">
            <view 
              class="completion-fill" 
              style="width: {{item.completionRate}}%"
            ></view>
          </view>
        </view>
        
        <!-- è§£é”æ ‡è¯† -->
        <view class="unlock-badge" wx:if="{{item.visitedMuseums > 0}}">
          <text class="badge-text">âœ¨</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åšç‰©é¦†åˆ—è¡¨ -->
  <view class="museums-section" wx:if="{{provinceInfo && viewMode === 'museums'}}">
    <view class="museums-grid">
      <view 
        class="museum-card {{item.isVisited ? 'visited' : 'unvisited'}}"
        wx:for="{{filteredMuseums}}" 
        wx:key="id"
        bindtap="onMuseumTap"
        data-id="{{item.id}}"
      >
        <!-- åšç‰©é¦†Logo -->
        <view class="museum-logo">
          <!-- é»˜è®¤å›¾æ ‡ -->
          <view class="default-logo">
            <text class="museum-icon">ğŸ›ï¸</text>
          </view>
          
          <!-- æ‰“å¡æ ‡è¯† (ä»…å·²æ‰“å¡æ˜¾ç¤º) -->
          <view class="checkin-badge" wx:if="{{item.isVisited}}">
            <text class="badge-icon">âœ“</text>
          </view>
        </view>
        
        <!-- åšç‰©é¦†ä¿¡æ¯ -->
        <view class="museum-info">
          <text class="museum-name">{{item.name}}</text>
          
          <!-- è¯¦ç»†ä¿¡æ¯åŒºåŸŸ -->
          <view class="detail-info">
            <!-- å·²æ‰“å¡ï¼šæ˜¾ç¤ºæ‰“å¡æ—¥æœŸå’Œè¯„åˆ† -->
            <block wx:if="{{item.isVisited}}">
              <text class="visit-date">{{item.visitDate}}</text>
              <view class="rating" wx:if="{{item.rating}}">
                <text class="rating-text">{{item.rating}}</text>
                <text class="star">â­</text>
              </view>
            </block>
            
            <!-- æœªæ‰“å¡ï¼šæ˜¾ç¤ºç­‰çº§ä¿¡æ¯ -->
            <block wx:else>
              <text class="museum-level">{{item.level}}</text>
            </block>
          </view>
        </view>

        <!-- ç­‰çº§æ ‡ç­¾ (ä»…æ˜¾ç¤ºå›½å®¶çº§å’Œä¸€çº§åšç‰©é¦†) -->
        <view class="level-tag {{item.level === 'å›½å®¶çº§' ? 'level-national' : item.level === 'å›½å®¶ä¸€çº§' ? 'level-first-class' : 'level-professional'}}" wx:if="{{item.level === 'å›½å®¶çº§' || item.level === 'å›½å®¶ä¸€çº§'}}">
          <text class="level-text">
            {{item.level === 'å›½å®¶çº§' ? 'å›½' : 'ä¸€çº§'}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && !provinceInfo}}">
    <image src="/images/empty-province.png" class="empty-icon" mode="aspectFit" />
    <text class="empty-text">çœä»½æ•°æ®åŠ è½½å¤±è´¥</text>
    <view class="empty-action" bindtap="onPullDownRefresh">
      <text class="action-text">é‡æ–°åŠ è½½</text>
    </view>
  </view>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-spacing"></view>
</view>
