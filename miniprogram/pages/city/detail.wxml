<!--city/detail.wxml-->
<view class="page-container">
  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <image src="/images/loading.gif" class="loading-icon" mode="aspectFit" />
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- åŸå¸‚æ¦‚è§ˆ -->
  <view class="city-header" wx:if="{{cityInfo}}">
    <view class="header-content">
      <view class="city-title">
        <text class="city-name">{{cityInfo.cityName}}</text>
        <text class="city-subtitle">{{cityInfo.provinceName}} Â· åšç‰©é¦†è¶³è¿¹</text>
      </view>
      
      <view class="city-stats">
        <view class="stat-card">
          <text class="stat-number">{{cityInfo.visitedMuseums}}</text>
          <text class="stat-label">å·²æ‰“å¡</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{cityInfo.totalMuseums - cityInfo.visitedMuseums}}</text>
          <text class="stat-label">å¾…æ¢ç´¢</text>
        </view>
        <view class="stat-card">
          <text class="stat-number">{{cityInfo.completionRate}}%</text>
          <text class="stat-label">å®Œæˆåº¦</text>
        </view>
      </view>
      
      <view class="city-progress">
        <view class="progress-bar">
          <view 
            class="progress-fill" 
            style="width: {{cityInfo.completionRate}}%"
          ></view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç­›é€‰å’Œæ’åº -->
  <view class="filter-section" wx:if="{{cityInfo}}">
    <!-- çŠ¶æ€ç­›é€‰ -->
    <view class="filter-tabs">
      <view 
        class="filter-tab {{filterStatus === 'all' ? 'active' : ''}}"
        bindtap="onFilterTap"
        data-status="all"
      >
        <text class="tab-text">å…¨éƒ¨</text>
      </view>
      <view 
        class="filter-tab {{filterStatus === 'visited' ? 'active' : ''}}"
        bindtap="onFilterTap"
        data-status="visited"
      >
        <text class="tab-text">å·²æ‰“å¡</text>
      </view>
      <view 
        class="filter-tab {{filterStatus === 'unvisited' ? 'active' : ''}}"
        bindtap="onFilterTap"
        data-status="unvisited"
      >
        <text class="tab-text">å¾…æ¢ç´¢</text>
      </view>
    </view>
  </view>

  <!-- åšç‰©é¦†åˆ—è¡¨ -->
  <view class="museums-section" wx:if="{{cityInfo}}">
    
    <view class="museums-grid">
      <view 
        class="museum-card {{item.isVisited ? 'visited' : 'unvisited'}}"
        wx:for="{{filteredMuseums}}" 
        wx:key="id"
        bindtap="onMuseumTap"
        data-id="{{item.id}}"
      >
        <!-- åšç‰©é¦†Logo -->
        <view class="museum-logo">
          <!-- é»˜è®¤å›¾æ ‡ -->
          <view class="default-logo">
            <text class="museum-icon">ğŸ›ï¸</text>
          </view>
          
          <!-- æ‰“å¡æ ‡è¯† (ä»…å·²æ‰“å¡æ˜¾ç¤º) -->
          <view class="checkin-badge" wx:if="{{item.isVisited}}">
            <text class="badge-icon">âœ“</text>
          </view>
        </view>
        
        <!-- åšç‰©é¦†ä¿¡æ¯ -->
        <view class="museum-info">
          <text class="museum-name">{{item.name}}</text>
          
          <!-- è¯¦ç»†ä¿¡æ¯åŒºåŸŸ -->
          <view class="detail-info">
            <!-- å·²æ‰“å¡ï¼šæ˜¾ç¤ºæ‰“å¡æ—¥æœŸå’Œè¯„åˆ† -->
            <block wx:if="{{item.isVisited}}">
              <text class="visit-date">{{item.visitDate}}</text>
              <view class="rating" wx:if="{{item.rating}}">
                <text class="rating-text">{{item.rating}}</text>
                <text class="star">â­</text>
              </view>
            </block>
            
            <!-- æœªæ‰“å¡ï¼šæ˜¾ç¤ºç­‰çº§ä¿¡æ¯ -->
            <block wx:else>
              <text class="museum-level">{{item.level}}</text>
            </block>
          </view>
        </view>

        <!-- ç­‰çº§æ ‡ç­¾ (ä»…æ˜¾ç¤ºå›½å®¶çº§å’Œä¸€çº§åšç‰©é¦†) -->
        <view class="level-tag {{item.level === 'å›½å®¶çº§' ? 'level-national' : item.level === 'å›½å®¶ä¸€çº§' ? 'level-first-class' : 'level-professional'}}" wx:if="{{item.level === 'å›½å®¶çº§' || item.level === 'å›½å®¶ä¸€çº§'}}">
          <text class="level-text">
            {{item.level === 'å›½å®¶çº§' ? 'å›½' : 'ä¸€çº§'}}
          </text>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && !cityInfo}}">
    <image src="/images/empty-city.png" class="empty-icon" mode="aspectFit" />
    <text class="empty-text">åŸå¸‚æ•°æ®åŠ è½½å¤±è´¥</text>
    <view class="empty-action" bindtap="onPullDownRefresh">
      <text class="action-text">é‡æ–°åŠ è½½</text>
    </view>
  </view>

  <!-- åŸå¸‚ä¸ºç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{cityInfo && cityInfo.museums.length === 0}}">
    <image src="/images/empty-museums.png" class="empty-icon" mode="aspectFit" />
    <text class="empty-text">è¯¥åŸå¸‚æš‚æ— åšç‰©é¦†æ•°æ®</text>
  </view>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-spacing"></view>
</view>
