<!--checkin-action.wxml-->
<scroll-view class="checkin-action-container" scroll-y>
  <!-- åšç‰©é¦†ä¿¡æ¯å¡ç‰‡ -->
  <view class="museum-info-card">
    <view class="museum-header">
      <view class="museum-basic-info">
        <text class="museum-name">{{museumInfo.name}}</text>
        <view class="museum-location">
          <icon type="locationfill" size="12" color="#999"></icon>
          <text class="location-text">{{museumInfo.address}}</text>
        </view>
        <view class="museum-distance">
          <text class="distance-text">è·ç¦»æ‚¨ {{museumInfo.distance}}</text>
          <view class="status-dot {{museumInfo.canCheckin ? 'status-available' : 'status-unavailable'}}"></view>
          <text class="status-text">{{museumInfo.canCheckin ? 'å¯æ‰“å¡' : 'è·ç¦»è¿‡è¿œ'}}</text>
        </view>
      </view>
      <image src="{{museumInfo.image}}" mode="aspectFill" class="museum-thumb" />
    </view>
  </view>

  <!-- æ‰“å¡ç…§ç‰‡ -->
  <view class="section-card">
    <view class="section-header">
      <text class="section-title">æ‰“å¡ç…§ç‰‡</text>
      <text class="photo-count" wx:if="{{photos.length > 0}}">({{photos.length}}å¼ )</text>
    </view>
    
    <view class="photo-grid" wx:if="{{photos.length > 0}}">
      <view class="photo-item" wx:for="{{photos}}" wx:key="index">
        <image src="{{item}}" mode="aspectFill" class="photo-image" bindtap="onPreviewPhoto" data-index="{{index}}" />
        <view class="photo-delete" bindtap="onDeletePhoto" data-index="{{index}}">Ã—</view>
      </view>
      <view class="add-photo-btn" wx:if="{{photos.length < 9}}" bindtap="onAddPhoto">
        <text class="add-icon">+</text>
      </view>
    </view>

    <view class="empty-photo" wx:else>
      <view class="empty-icon">ğŸ“·</view>
      <text class="empty-text">è¿˜æ²¡æœ‰æ·»åŠ ç…§ç‰‡å“¦</text>
      <view class="take-photo-btn" bindtap="onAddPhoto">
        <text class="btn-text">æ·»åŠ ç…§ç‰‡</text>
      </view>
    </view>
  </view>

  <!-- æ‰“å¡æ„Ÿå— -->
  <view class="section-card">
    <text class="section-title">æ‰“å¡æ„Ÿå—<text class="required-star">*</text></text>
    <textarea 
      class="feeling-input" 
      placeholder="åˆ†äº«æ‚¨çš„å‚è§‚æ„Ÿå—..." 
      value="{{feeling}}"
      bindinput="onFeelingInput"
      maxlength="500"
      show-confirm-bar="{{false}}"
    />
    <text class="input-count">{{feeling.length}}/500</text>
  </view>

  <!-- è¯„åˆ†ã€å¿ƒæƒ…ã€å¤©æ°” -->
  <view class="section-card">
    <!-- è¯„åˆ† -->
    <view class="rating-section">
      <text class="section-title">è¯„åˆ†<text class="required-star">*</text></text>
      <view class="star-rating">
        <view class="star-item {{rating === item.value ? 'star-selected' : ''}}" 
              wx:for="{{ratingOptions}}" 
              wx:key="value"
              bindtap="onRatingTap" 
              data-rating="{{item.value}}">
          <text class="star-icon">{{rating === item.value ? 'â˜…' : 'â˜†'}}</text>
          <text class="star-text">{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- å¿ƒæƒ… -->
    <view class="mood-section">
      <text class="section-title">å¿ƒæƒ…<text class="required-star">*</text></text>
      <view class="mood-options">
        <view class="mood-item {{selectedMood === item.value ? 'mood-selected' : ''}}" 
              wx:for="{{moodOptions}}" 
              wx:key="value"
              bindtap="onMoodSelect" 
              data-mood="{{item.value}}">
          <text class="mood-emoji">{{item.emoji}}</text>
          <text class="mood-text">{{item.label}}</text>
        </view>
      </view>
    </view>

    <!-- å¤©æ°” -->
    <view class="weather-section">
      <text class="section-title">å¤©æ°”<text class="required-star">*</text></text>
      <view class="weather-options">
        <view class="weather-item {{selectedWeather === item.value ? 'weather-selected' : ''}}" 
              wx:for="{{weatherOptions}}" 
              wx:key="value"
              bindtap="onWeatherSelect" 
              data-weather="{{item.value}}">
          <text class="weather-emoji">{{item.emoji}}</text>
          <text class="weather-text">{{item.label}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŒè¡Œä¼™ä¼´ -->
  <view class="section-card">
    <text class="section-title">åŒè¡Œä¼™ä¼´</text>
    <view class="companion-input">
      <input 
        class="companion-field" 
        placeholder="æ·»åŠ åŒè¡Œä¼™ä¼´" 
        value="{{companionInput}}"
        bindinput="onCompanionInput"
        bindconfirm="onAddCompanion"
      />
      <view class="add-companion-btn" bindtap="onAddCompanion">æ·»åŠ </view>
    </view>
    <view class="companion-list" wx:if="{{companions.length > 0}}">
      <view class="companion-tag" wx:for="{{companions}}" wx:key="index">
        <text class="companion-name">{{item}}</text>
        <text class="companion-delete" bindtap="onDeleteCompanion" data-index="{{index}}">Ã—</text>
      </view>
    </view>
  </view>

  <!-- æ ‡ç­¾ -->
  <view class="section-card">
    <text class="section-title">æ ‡ç­¾</text>
    <view class="tag-input">
      <input 
        class="tag-field" 
        placeholder="æ·»åŠ æ ‡ç­¾" 
        value="{{tagInput}}"
        bindinput="onTagInput"
        bindconfirm="onAddTag"
      />
      <view class="add-tag-btn" bindtap="onAddTag">æ·»åŠ </view>
    </view>
    <view class="tag-list" wx:if="{{tags.length > 0}}">
      <view class="tag-item" wx:for="{{tags}}" wx:key="index">
        <text class="tag-text">#{{item}}</text>
        <text class="tag-delete" bindtap="onDeleteTag" data-index="{{index}}">Ã—</text>
      </view>
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="action-buttons">
    <view class="save-draft-btn" bindtap="onSaveDraft">
      æš‚å­˜
    </view>
    <view class="checkin-btn {{canSubmitCheckin ? 'btn-enabled' : 'btn-disabled'}}" 
          bindtap="onSubmitCheckin">
      {{museumInfo.canCheckin ? (canSubmitCheckin ? 'æ‰“å¡' : 'è¯·å®Œå–„å¿…å¡«ä¿¡æ¯') : 'æ— æ³•æ‰“å¡'}}
    </view>
  </view>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-spacing"></view>
</scroll-view>
