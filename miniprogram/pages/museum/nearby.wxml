<!--nearby.wxml-->
<view class="page-container">
  
  <!-- å®šä½ä¿¡æ¯å’Œæœç´¢æ  -->
  <view class="header-container">
    <view class="header-row">
      <!-- å®šä½ä¿¡æ¯ -->
      <view class="location-info" wx:if="{{currentLocation}}" bindtap="onRefreshLocation">
        <view class="location-icon">ğŸ“</view>
        <text class="location-text">{{currentLocation.cityName || 'æ­£åœ¨å®šä½...'}}</text>
      </view>
      
      <!-- æœç´¢æ¡† -->
      <view class="search-container">
        <view class="search-box">
          <icon type="search" size="16" color="#999" class="search-icon"></icon>
          <input class="search-input" 
                 placeholder="æœç´¢åšç‰©é¦†åç§°" 
                 value="{{searchKeyword}}"
                 bindinput="onSearchInput"
                 bindconfirm="onSearchConfirm"
                 confirm-type="search" />
          <view wx:if="{{searchKeyword}}" class="search-clear" bindtap="onSearchClear">
            <icon type="clear" size="14" color="#ccc"></icon>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- åšç‰©é¦†åˆ—è¡¨ -->
  <view class="museum-list">
    <view class="list-header" wx:if="{{museums.length > 0}}">
      <text class="list-count">åŒåŸå…±æœ‰ {{total}} å®¶åšç‰©é¦†</text>
    </view>
    
    <view class="museum-item" wx:for="{{museums}}" wx:key="id" bindtap="onMuseumTap" data-id="{{item.id}}">
      <image src="{{item.image || '/images/default-museum.png'}}" mode="aspectFill" class="museum-image" />
      <view class="museum-info">
        <view class="museum-name">{{item.name}}</view>
        <view class="museum-location">
          <icon type="locationfill" size="12" color="#999"></icon>
          <text class="location-text">{{item.address || item.cityName}}</text>
        </view>
        <view class="museum-meta">
          <text class="distance" wx:if="{{item.distance}}">è·ç¦»: {{item.distance}}km</text>
          <text class="collection-count" wx:if="{{item.collectionCount}}">è—å“: {{item.collectionCount}}ä»¶</text>
        </view>
        <view class="museum-tags" wx:if="{{item.tags && item.tags.length > 0}}">
          <view wx:for="{{item.tags}}" wx:key="id" wx:for-item="tag" class="tag" style="background-color: {{tag.color || '#f0f8ff'}};">
            {{tag.name}}
          </view>
        </view>
        <view class="museum-description" wx:if="{{item.description}}">
          {{item.description}}
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å®šä½å¤±è´¥æç¤º -->
  <view class="location-error" wx:if="{{locationError && museums.length === 0 && !loading}}">
    <view class="error-icon">ğŸ“</view>
    <text class="error-title">éœ€è¦å®šä½æƒé™</text>
    <text class="error-desc">ä¸ºäº†ä¸ºæ‚¨å±•ç¤ºåŒåŸçš„åšç‰©é¦†ï¼Œéœ€è¦è·å–æ‚¨çš„ä½ç½®ä¿¡æ¯</text>
    <view class="retry-button" bindtap="onRetryLocation">é‡æ–°å®šä½</view>
    <view class="setting-button" bindtap="onOpenSetting">æ‰“å¼€è®¾ç½®</view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-container" wx:if="{{!loading && !locationError && museums.length === 0}}">
    <text class="empty-text">åŒåŸæš‚æ— åšç‰©é¦†</text>
    <view class="empty-button" bindtap="onRefresh">åˆ·æ–°</view>
  </view>

  <!-- æ²¡æœ‰æ›´å¤šæ•°æ® -->
  <view class="no-more-container" wx:if="{{!loading && museums.length > 0 && !hasMore}}">
    <text class="no-more-text">æ²¡æœ‰æ›´å¤šæ•°æ®äº†</text>
  </view>

  <!-- åº•éƒ¨é—´è· -->
  <view class="bottom-spacing"></view>
</view>
