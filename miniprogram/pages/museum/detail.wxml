<!--museum/detail.wxml-->
<view class="page-container">
  <view wx:if="{{loading}}" class="loading-container">
    <view class="loading-content">
      <view class="loading-spinner"></view>
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>

  <view wx:elif="{{error}}" class="error-container">
    <view class="error-content">
      <image src="/images/Icon1.png" class="error-icon" mode="aspectFit" />
      <text class="error-text">{{error}}</text>
      <button class="retry-btn" bindtap="loadMuseumDetail">é‡æ–°åŠ è½½</button>
    </view>
  </view>

  <view wx:elif="{{museumDetail}}" class="main-content">
  <!-- å›¾ç‰‡è½®æ’­ -->
  <view class="image-section">
    <swiper class="image-swiper" autoplay="{{true}}" interval="4000" duration="500" circular="{{true}}" indicator-dots="{{true}}" indicator-color="rgba(255,255,255,0.5)" indicator-active-color="#fff">
      <swiper-item wx:for="{{museumDetail.images}}" wx:key="*this">
        <image src="{{item}}" mode="aspectFill" class="detail-image" bindtap="onImagePreview" data-url="{{item}}" />
      </swiper-item>
    </swiper>
  </view>

  <!-- åšç‰©é¦†ä¿¡æ¯ -->
  <view class="info-section">
    <view class="museum-header">
      <view class="title-with-actions">
        <view class="museum-title">{{museumDetail.name}}</view>
        <view class="header-actions">
          <view class="header-btn" bindtap="onFavorite">
            <image wx:if="{{museumDetail.isFavorited}}" src="/images/favorite.svg" class="svg-icon favorite-icon" mode="aspectFit" />
            <image wx:else src="/images/favorite.svg" class="svg-icon favorite-icon-outline" mode="aspectFit" />
          </view>
          <view class="header-btn" bindtap="onNavigation">
            <image src="/images/navigation.svg" class="svg-icon navigation-icon-dark" mode="aspectFit" />
          </view>
        </view>
      </view>
      <view class="museum-rating">
        <text class="rating-score">{{museumDetail.rating}}</text>
        <text class="rating-total">/5.0 ({{museumDetail.reviewCount}}æ¡è¯„ä»·)</text>
      </view>
    </view>

    <view class="museum-meta">
      <view class="meta-item">
        <icon type="locationfill" size="14" color="#999"></icon>
        <text class="meta-text">{{museumDetail.address}}</text>
      </view>
      <view class="meta-item">
        <icon type="clock" size="14" color="#999"></icon>
        <text class="meta-text">{{museumDetail.openTime}}</text>
      </view>
      <view class="meta-item" wx:if="{{museumDetail.freeAdmission}}">
        <icon type="money" size="14" color="#4CAF50"></icon>
        <text class="meta-text free-admission">å…è´¹å¼€æ”¾</text>
      </view>
      <view class="meta-item" wx:else>
        <icon type="money" size="14" color="#999"></icon>
        <text class="meta-text">Â¥{{museumDetail.ticketPrice || 0}}/äºº</text>
      </view>
      <view class="meta-item" wx:if="{{museumDetail.level}}">
        <icon type="star" size="14" color="#FFD700"></icon>
        <text class="meta-text">å›½å®¶{{museumDetail.level === 1 ? 'ä¸€' : museumDetail.level === 2 ? 'äºŒ' : 'ä¸‰'}}çº§åšç‰©é¦†</text>
      </view>
    </view>

    <!-- åšç‰©é¦†æ ‡ç­¾ -->
    <view class="museum-tags">
      <!-- è¯„åˆ†æ ‡ç­¾ -->
      <view class="tag rating-tag">
        <text class="rating-score-tag">{{museumDetail.rating || 4.5}}</text>
        <text class="rating-star">â˜…</text>
      </view>
      
      <!-- é—¨ç¥¨ä»·æ ¼æ ‡ç­¾ -->
      <view class="tag price-tag" wx:if="{{museumDetail.ticketPrice}}">
        <text class="price-icon">ğŸ’°</text>
        <text class="price-text">{{museumDetail.ticketPrice}}</text>
      </view>
      
      <!-- å¼€æ”¾çŠ¶æ€æ ‡ç­¾ -->
      <view class="tag status-tag {{museumDetail.isOpen ? 'open' : 'closed'}}">
        {{museumDetail.isOpen ? 'è¥ä¸šä¸­' : 'å·²é—­é¦†'}}
      </view>
      
      <!-- ç‰¹è‰²æ ‡ç­¾ -->
      <view wx:for="{{museumDetail.tags}}" wx:key="*this" class="tag feature-tag">
        {{item}}
      </view>
    </view>

    <!-- åšç‰©é¦†ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats-section">
      <view class="stats-grid">
        <view class="stat-item">
          <text class="stat-number">{{formatNumber(museumDetail.collectionCount)}}</text>
          <text class="stat-label">é¦†è—æ–‡ç‰©</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{formatNumber(museumDetail.visitorCount)}}</text>
          <text class="stat-label">å¹´è®¿å®¢é‡</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{formatNumber(museumDetail.exhibitions)}}</text>
          <text class="stat-label">å±•è§ˆæ•°é‡</text>
        </view>
        <view class="stat-item">
          <text class="stat-number">{{formatNumber(museumDetail.educationActivities)}}</text>
          <text class="stat-label">æ•™è‚²æ´»åŠ¨</text>
        </view>
      </view>
    </view>
  </view>


  <!-- åšç‰©é¦†ä»‹ç» -->
  <view class="description-section">
    <view class="section-title">åšç‰©é¦†ä»‹ç»</view>
    <view class="description-content">
      <text class="description-text {{showFullDesc ? 'full-text' : 'ellipsis-text'}}">{{museumDetail.description}}</text>
      <text class="toggle-btn" bindtap="onToggleDesc">{{showFullDesc ? 'æ”¶èµ·' : 'å±•å¼€'}}</text>
    </view>
  </view>

  <!-- å½“å‰å±•è§ˆ -->
  <view class="exhibition-section" wx:if="{{exhibitions.length > 0}}">
    <view class="section-title">å½“å‰å±•è§ˆ</view>
    <view class="exhibition-list">
      <view class="exhibition-item" wx:for="{{exhibitions}}" wx:key="id" bindtap="onExhibitionTap" data-id="{{item.id}}">
        <image src="{{item.image}}" mode="aspectFill" class="exhibition-image" />
        <view class="exhibition-info">
          <view class="exhibition-title">{{item.title}}</view>
          <view class="exhibition-date">{{item.startDate}} - {{item.endDate}}</view>
          <view class="exhibition-status {{item.status === 'è¿›è¡Œä¸­' ? 'status-active' : 'status-upcoming'}}">
            {{item.status}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- é—¨ç¥¨ä¿¡æ¯ -->
  <view class="ticket-section" wx:if="{{museumDetail.ticketDescription}}">
    <view class="section-title">é—¨ç¥¨ä¿¡æ¯</view>
    <view class="ticket-content">
      <text class="ticket-description">{{museumDetail.ticketDescription}}</text>
    </view>
  </view>

  <!-- å‚è§‚é¡»çŸ¥ -->
  <view class="notice-section">
    <view class="section-title">å‚è§‚é¡»çŸ¥</view>
    <view class="notice-list">
      <view class="notice-item">
        <text class="notice-icon">ğŸ«</text>
        <text class="notice-text">è¯·æå‰é¢„çº¦ï¼Œæºå¸¦æœ‰æ•ˆèº«ä»½è¯ä»¶</text>
      </view>
      <view class="notice-item">
        <text class="notice-icon">ğŸ“·</text>
        <text class="notice-text">éƒ¨åˆ†å±•å…ç¦æ­¢æ‹ç…§ï¼Œè¯·éµå®ˆç›¸å…³è§„å®š</text>
      </view>
      <view class="notice-item">
        <text class="notice-icon">ğŸ”‡</text>
        <text class="notice-text">å‚è§‚æ—¶è¯·ä¿æŒå®‰é™ï¼Œå‹¿å¤§å£°å–§å“—</text>
      </view>
      <view class="notice-item">
        <text class="notice-icon">ğŸ‘¶</text>
        <text class="notice-text">å„¿ç«¥éœ€åœ¨æˆäººé™ªåŒä¸‹å‚è§‚</text>
      </view>
    </view>
  </view>

  <!-- è”ç³»æ–¹å¼ -->
  <view class="contact-section">
    <view class="section-title">è”ç³»æ–¹å¼</view>
    <view class="contact-list">
      <view class="contact-item" bindtap="onPhone">
        <icon type="phone" size="16" color="#ff8fa3"></icon>
        <text class="contact-text phone-number">{{museumDetail.phone || '400-123-4567'}}</text>
      </view>
      <view class="contact-item" wx:if="{{museumDetail.website}}" bindtap="onWebsite">
        <icon type="link" size="16" color="#ff8fa3"></icon>
        <text class="contact-text website-link">å®˜æ–¹ç½‘ç«™</text>
      </view>
    </view>
  </view>

    <!-- åº•éƒ¨é—´è· -->
    <view class="bottom-spacing"></view>
  </view>
</view>
